
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Equalizer - Web Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .content {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 0;
            min-height: 800px;
        }
        
        .controls {
            background: #f8f9fa;
            padding: 30px;
            border-right: 1px solid #e9ecef;
        }
        
        .mode-selector {
            margin-bottom: 30px;
        }
        
        .mode-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .mode-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: #e9ecef;
            color: #495057;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .mode-btn.active {
            background: #007bff;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.3);
        }
        
        .mode-btn:hover:not(.active) {
            background: #dee2e6;
        }
        
        .sliders-container {
            margin-top: 20px;
        }
        
        .band-slider {
            margin-bottom: 25px;
        }
        
        .band-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .band-name {
            font-weight: 600;
            color: #495057;
        }
        
        .band-value {
            background: #007bff;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            background: #e9ecef;
            border-radius: 10px;
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #007bff;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .slider::-webkit-slider-thumb:hover {
            background: #0056b3;
            transform: scale(1.2);
        }
        
        .action-buttons {
            margin-top: 30px;
            display: flex;
            gap: 15px;
        }
        
        .action-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .play-btn {
            background: #28a745;
            color: white;
        }
        
        .play-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .save-btn {
            background: #6c757d;
            color: white;
        }
        
        .save-btn:hover {
            background: #545b62;
            transform: translateY(-2px);
        }
        
        .visualization {
            padding: 30px;
            background: white;
        }
        
        .plot-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .plot-image {
            width: 100%;
            height: auto;
            border-radius: 8px;
        }
        
        .ai-sliders {
            margin-top: 20px;
        }
        
        .ai-slider {
            margin-bottom: 20px;
        }
        
        .ai-slider-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéõÔ∏è AI Audio Equalizer</h1>
            <p>Control frequency bands manually or use AI-powered separation</p>
        </div>
        
        <div class="content">
            <div class="controls">
                <div class="mode-selector">
                    <h3>üéöÔ∏è Equalizer Mode</h3>
                    <div class="mode-buttons">
                        <button class="mode-btn" onclick="switchMode('manual')">Manual EQ</button>
                        <button class="mode-btn" onclick="switchMode('human_voices')">AI Voices</button>
                        <button class="mode-btn" onclick="switchMode('musical_instruments')">AI Instruments</button>
                    </div>
                </div>
                
                <div class="sliders-container">
                    <div id="manual-sliders">
                        <h3>üéõÔ∏è Frequency Bands</h3>
                        <div id="band-sliders"></div>
                    </div>
                    
                    <div id="ai-sliders" style="display: none;">
                        <h3>ü§ñ AI Controls</h3>
                        <div id="ai-voice-sliders" class="ai-sliders">
                            <!-- AI voice sliders will be added here -->
                        </div>
                        <div id="ai-instrument-sliders" class="ai-sliders" style="display: none;">
                            <!-- AI instrument sliders will be added here -->
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="action-btn play-btn" onclick="playAudio()">‚ñ∂Ô∏è Play Audio</button>
                    <button class="action-btn save-btn" onclick="saveAudio()">üíæ Save Audio</button>
                </div>
            </div>
            
            <div class="visualization">
                <h3>üìä Audio Visualization</h3>
                <div class="plot-container">
                    <img id="plot-image" class="plot-image" src="" alt="Audio Visualization">
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentMode = 'manual';
        
        // Initialize the interface
        async function initialize() {
            const response = await fetch('/get_initial_data');
            const data = await response.json();
            
            currentMode = data.current_mode;
            updateModeButtons();
            
            if (currentMode === 'manual') {
                createManualSliders(data.manual_bands);
            } else {
                createAISliders(data.current_mode, data.ai_sliders);
            }
            
            updateVisualization();
        }
        
        // Create manual frequency band sliders
        function createManualSliders(bands) {
            const container = document.getElementById('band-sliders');
            container.innerHTML = '';
            
            bands.forEach((band, index) => {
                const sliderDiv = document.createElement('div');
                sliderDiv.className = 'band-slider';
                sliderDiv.innerHTML = `
                    <div class="band-header">
                        <span class="band-name">${band.name}</span>
                        <span class="band-value">${band.gain.toFixed(2)}</span>
                    </div>
                    <input type="range" class="slider" min="0" max="2" step="0.01" 
                           value="${band.gain}" 
                           oninput="updateBandGain(${index}, this.value)"
                           style="accent-color: ${band.color}">
                    <div style="font-size: 0.8em; color: #6c757d; margin-top: 5px;">
                        ${band.range[0]} - ${band.range[1]} Hz
                    </div>
                `;
                container.appendChild(sliderDiv);
            });
        }
        
        // Create AI mode sliders
        function createAISliders(mode, sliders) {
            const voiceContainer = document.getElementById('ai-voice-sliders');
            const instrumentContainer = document.getElementById('ai-instrument-sliders');
            
            if (mode === 'human_voices') {
                voiceContainer.style.display = 'block';
                instrumentContainer.style.display = 'none';
                
                const labels = ['Voice 1', 'Voice 2', 'Voice 3', 'Background'];
                voiceContainer.innerHTML = '';
                
                labels.forEach((label, index) => {
                    const sliderDiv = document.createElement('div');
                    sliderDiv.className = 'ai-slider';
                    sliderDiv.innerHTML = `
                        <div class="ai-slider-label">${label}</div>
                        <input type="range" class="slider" min="0" max="2" step="0.01" 
                               value="${sliders[mode][index]}" 
                               oninput="updateAISlider('${mode}', ${index}, this.value)">
                    `;
                    voiceContainer.appendChild(sliderDiv);
                });
            } else {
                voiceContainer.style.display = 'none';
                instrumentContainer.style.display = 'block';
                
                const labels = ['Drums', 'Bass', 'Melody', 'Vocals'];
                instrumentContainer.innerHTML = '';
                
                labels.forEach((label, index) => {
                    const sliderDiv = document.createElement('div');
                    sliderDiv.className = 'ai-slider';
                    sliderDiv.innerHTML = `
                        <div class="ai-slider-label">${label}</div>
                        <input type="range" class="slider" min="0" max="2" step="0.01" 
                               value="${sliders[mode][index]}" 
                               oninput="updateAISlider('${mode}', ${index}, this.value)">
                    `;
                    instrumentContainer.appendChild(sliderDiv);
                });
            }
        }
        
        // Switch between modes
        async function switchMode(mode) {
            const response = await fetch('/switch_mode', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({mode: mode})
            });
            
            if (response.ok) {
                currentMode = mode;
                updateModeButtons();
                
                if (mode === 'manual') {
                    document.getElementById('manual-sliders').style.display = 'block';
                    document.getElementById('ai-sliders').style.display = 'none';
                    // Reload manual sliders
                    const data = await (await fetch('/get_initial_data')).json();
                    createManualSliders(data.manual_bands);
                } else {
                    document.getElementById('manual-sliders').style.display = 'none';
                    document.getElementById('ai-sliders').style.display = 'block';
                    // Reload AI sliders
                    const data = await (await fetch('/get_initial_data')).json();
                    createAISliders(mode, data.ai_sliders);
                }
                
                updateVisualization();
            }
        }
        
        // Update mode buttons appearance
        function updateModeButtons() {
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.querySelectorAll('.mode-btn').forEach(btn => {
                if (btn.textContent.includes(currentMode === 'manual' ? 'Manual' : 
                    currentMode === 'human_voices' ? 'Voices' : 'Instruments')) {
                    btn.classList.add('active');
                }
            });
        }
        
        // Update manual band gain
        async function updateBandGain(bandIndex, gain) {
            await fetch('/update_band_gain', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({band_index: bandIndex, gain: parseFloat(gain)})
            });
            
            // Update display value
            document.querySelectorAll('.band-value')[bandIndex].textContent = parseFloat(gain).toFixed(2);
            updateVisualization();
        }
        
        // Update AI slider
        async function updateAISlider(mode, sliderIndex, value) {
            await fetch('/update_ai_slider', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    mode: mode,
                    slider_index: sliderIndex,
                    value: parseFloat(value)
                })
            });
            updateVisualization();
        }
        
        // Update visualization
        async function updateVisualization() {
            const response = await fetch('/get_visualization');
            const data = await response.json();
            document.getElementById('plot-image').src = 'data:image/png;base64,' + data.plot;
        }
        
        // Play audio
        async function playAudio() {
            await fetch('/play_audio');
        }
        
        // Save audio
        async function saveAudio() {
            const response = await fetch('/save_audio');
            const data = await response.json();
            if (data.success) {
                alert('Audio saved as: ' + data.filename);
            } else {
                alert('Error saving audio: ' + data.error);
            }
        }
        
        // Initialize on load
        window.onload = initialize;
        
        // Auto-refresh visualization every 2 seconds when sliders are being dragged
        let isDragging = false;
        document.addEventListener('mousedown', (e) => {
            if (e.target.classList.contains('slider')) {
                isDragging = true;
                startAutoRefresh();
            }
        });
        
        document.addEventListener('mouseup', () => {
            isDragging = false;
        });
        
        function startAutoRefresh() {
            if (isDragging) {
                updateVisualization();
                setTimeout(startAutoRefresh, 200);
            }
        }
    </script>
</body>
</html>
